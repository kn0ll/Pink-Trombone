!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(1),n=i(5);class r extends HTMLElement{constructor(){super(),this._animationFrameObservers=[],window.customElements.whenDefined("pink-trombone").then(()=>{this.addEventListener("requestAnimationFrame",t=>{this._animationFrameObservers.includes(t.target)||this._animationFrameObservers.push(t.target);const e=new CustomEvent("didRequestAnimationFrame");t.target.dispatchEvent(e),t.stopPropagation()}),this.addEventListener("resume",t=>{this.audioContext.resume(),this.pinkTrombone.start(),t.target.dispatchEvent(new CustomEvent("didResume"))}),this.addEventListener("setParameter",t=>{const e=t.detail.parameterName.split(".").reduce((t,e)=>t[e],this.parameters),i=Number(t.detail.newValue);switch(t.detail.type){case"linear":e.linearRampToValueAtTime(i,this.audioContext.currentTime+t.detail.timeOffset);break;default:e.value=i}t.target.dispatchEvent(new CustomEvent("didSetParameter",{detail:t.detail})),t.stopPropagation()}),this.addEventListener("getParameter",t=>{const e=t.detail.parameterName.split(".").reduce((t,e)=>t[e],this.parameters).value,i=t.detail;i.value=e,t.target.dispatchEvent(new CustomEvent("didGetParameter",{detail:i})),t.stopPropagation()}),this.addEventListener("newConstriction",t=>{const{index:e,diameter:i}=t.detail,s=this.newConstriction(e,i),n=t.detail;n.constrictionIndex=s._index,t.target.dispatchEvent(new CustomEvent("didNewConstriction",{detail:n})),t.stopPropagation()}),this.addEventListener("setConstriction",t=>{const e=Number(t.detail.constrictionIndex),i=this.constrictions[e];if(i){const{index:e,diameter:s}=t.detail,n=e||i.index.value,r=s||i.diameter.value;switch(t.detail.type){case"linear":i.index.linearRampToValueAtTime(n,t.detail.endTime),i.diameter.linearRampToValueAtTime(r,t.detail.endTime);break;default:i.index.value=n,i.diameter.value=r}t.target.dispatchEvent(new CustomEvent("didSetConstriction"))}t.stopPropagation()}),this.addEventListener("getConstriction",t=>{const e=Number(t.detail.constrictionIndex),i=this.constrictions[e];t.target.dispatchEvent(new CustomEvent("didGetConstriction",{detail:{index:i.index.value,diameter:i.diameter.value}})),t.stopPropagation()}),this.addEventListener("removeConstriction",t=>{const e=Number(t.detail.constrictionIndex),i=this.constrictions[e];this.removeConstriction(i);const s=t.detail;t.target.dispatchEvent(new CustomEvent("didRemoveConstriction",{detail:s})),t.stopPropagation()}),this.addEventListener("getProcessor",t=>{this.getProcessor().then(e=>{t.target.dispatchEvent(new CustomEvent("didGetProcessor",{detail:{processor:e}}))}),t.stopPropagation()})}),null!==this.getAttribute("UI")&&this.enableUI();const t=new Event("load");this.dispatchEvent(t)}enableUI(){null==this.UI&&(this.UI=new n.default,this.appendChild(this.UI.node)),this.UI.show()}disableUI(){void 0!==this.UI&&(this.UI.hide(),this.stopUI())}startUI(){void 0!==this.UI&&(this._isRunning=!0,window.requestAnimationFrame(t=>{this._requestAnimationFrameCallback(t)}))}stopUI(){this._isRunning=!1}static get observedAttributes(){return["UI"]}attributeChangedCallback(t,e,i){switch(t){case"UI":null!==i?this.enableUI():this.disableUI()}}setAudioContext(t=new AudioContext){return this.pinkTrombone=new s.default(t),this.loadPromise=this.pinkTrombone.loadPromise.then(t=>{this.parameters=this.pinkTrombone.parameters;for(let t in this.pinkTrombone.parameters)this[t]=this.pinkTrombone.parameters[t];return this.pinkTrombone}),this.loadPromise}get audioContext(){if(this.pinkTrombone)return this.pinkTrombone.audioContext;throw"Audio Context has not been set"}set audioContext(t){this.setAudioContext(t)}connect(){if(this.pinkTrombone)return this.pinkTrombone.connect(...arguments)}disconnect(){if(this.pinkTrombone)return this.pinkTrombone.disconnect(...arguments)}start(){if(!this.pinkTrombone)throw"Pink Trombone hasn't been set yet";this.pinkTrombone.start(),this.startUI()}stop(){if(!this.pinkTrombone)throw"Pink Trombone hasn't been set yet";this.pinkTrombone.stop(),this.stopUI()}_requestAnimationFrameCallback(t){this._isRunning&&(this._animationFrameObservers.forEach(e=>{const i=new CustomEvent("animationFrame",{detail:{highResTimeStamp:t}});e.dispatchEvent(i)}),window.requestAnimationFrame(t=>this._requestAnimationFrameCallback.call(this,t)))}get constrictions(){return this.pinkTrombone.constrictions}newConstriction(){return this.pinkTrombone.newConstriction(...arguments)}removeConstriction(t){return this.pinkTrombone.removeConstriction(t)}getProcessor(){return this.pinkTrombone.getProcessor()}}document.createElement("pink-trombone").constructor==HTMLElement&&window.customElements.define("pink-trombone",r),e.default=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(2),n=i(3);e.default=class{constructor(t){this.audioContext=t,this.loadPromise=this.addModules(t).then(()=>(this.audioContext=t,this.setupAudioGraph(),this.audioContext))}addModules(t){return void 0!==t.audioWorklet?t.audioWorklet.addModule("./pink-trombone-worklet-processor.min.js"):new Promise((t,e)=>{t()})}setupAudioGraph(){this._noise=s.default(this.audioContext),this._aspirateFilter=this.audioContext.createBiquadFilter(),this._aspirateFilter.type="bandpass",this._aspirateFilter.frequency.value=500,this._aspirateFilter.Q.value=.5,this._fricativeFilter=this.audioContext.createBiquadFilter(),this._fricativeFilter.type="bandpass",this._fricativeFilter.frequency.value=1e3,this._fricativeFilter.Q.value=.5,this._pinkTromboneNode=new n.default(this.audioContext),this._noise.connect(this._aspirateFilter),this._aspirateFilter.connect(this._pinkTromboneNode.noise),this._noise.connect(this._fricativeFilter),this._fricativeFilter.connect(this._pinkTromboneNode.noise),this._gain=this.audioContext.createGain(),this._gain.gain.value=0,this._pinkTromboneNode.connect(this._gain)}get parameters(){return this._pinkTromboneNode._parameters}connect(){return this._gain.connect(...arguments)}disconnect(){return this._gain.disconnect(...arguments)}start(){this._gain.gain.value=1}stop(){this._gain.gain.value=0}get constrictions(){return this._pinkTromboneNode.constrictions}newConstriction(){return this._pinkTromboneNode.newConstriction(...arguments)}removeConstriction(t){this._pinkTromboneNode.removeConstriction(t)}getProcessor(){return this._pinkTromboneNode.getProcessor()}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=function(t){const e=t.createBufferSource(),i=t.createBuffer(1,1*t.sampleRate,t.sampleRate),s=i.getChannelData(0);for(let t=0;t<s.length;t++)s[t]=2*Math.random()-1;return e.buffer=i,e.loop=!0,e.start(),e}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(4);class n extends AudioWorkletNode{constructor(t){super(t,"pink-trombone-worklet-processor"),function(t){t._constrictions=[];for(let e=0;e<s.numberOfConstrictions;e++)t._constrictions[e]={_index:e,index:null,diameter:null,_enable:()=>t._enableConstriction(e),_disable:()=>t._disableConstriction(e),_isEnabled:!1};t.newConstriction=function(t,e){return this._constrictions.find(i=>{if(!i._isEnabled)return void 0!==t&&(i.index.value=t),void 0!==e&&(i.diameter.value=e),i._enable(),!0})},t.removeConstriction=function(t){t._disable()},Object.defineProperty(t,"constrictions",{get:function(){return this._constrictions.filter(t=>t._isEnabled)}}),t._parameters={},t.tongue=t._parameters.tongue={index:null,diameter:null},t.vibrato=t._parameters.vibrato={frequency:null,gain:null,wobble:null}}(this),this.parameters.forEach((t,e)=>{!function(t,e,i){if(i.includes("constriction")){const s=Number(i.match(/[0-9]+/g)[0]),n=t._constrictions[s];n[i.includes("index")?"index":"diameter"]=e,t.constrictions[s]=n}else i.includes("vibrato")?t.vibrato[i.replace("vibrato","").toLowerCase()]=e:i.includes("tongue")?t.tongue[i.replace("tongue","").toLowerCase()]=e:t[i]=t._parameters[i]=e}(this,t,e)}),this.port.onmessage=t=>{t.data.name}}_postMessage(t){return t.id=Math.random(),new Promise((e,i)=>{const s=i=>{t.id==Number(i.data.id)&&(this.port.removeEventListener("message",s),e(i))};this.port.addEventListener("message",s),this.port.postMessage(t)})}_enableConstriction(t){return this._postMessage({name:"enableConstriction",constrictionIndex:t}).then(()=>{this._constrictions[t]._isEnabled=!0})}_disableConstriction(t){return this._postMessage({name:"disableConstriction",constrictionIndex:t}).then(()=>{this._constrictions[t]._isEnabled=!1})}getProcessor(){return this._postMessage({name:"getProcessor"}).then(t=>JSON.parse(t.data.processor))}}e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.numberOfConstrictions=void 0;const s=[{name:"noise",defaultValue:0,minValue:-1,maxValue:1},{name:"frequency",defaultValue:140,minValue:0},{name:"tenseness",defaultValue:.6,minValue:0,maxValue:1},{name:"intensity",defaultValue:1,minValue:0,maxValue:1},{name:"loudness",defaultValue:1,minValue:0,maxValue:1},{name:"tongueIndex",defaultValue:12.9},{name:"tongueDiameter",defaultValue:2.43},{name:"vibratoWobble",defaultValue:1,minValue:0,maxValue:1},{name:"vibratoFrequency",defaultValue:6,minValue:0},{name:"vibratoGain",defaultValue:.005,minValue:0}];e.numberOfConstrictions=4;for(let t=0;t<e.numberOfConstrictions;t++){const e=[{name:"constriction"+t+"index",defaultValue:0,automationRate:"k-rate"},{name:"constriction"+t+"diameter",defaultValue:0,automationRate:"k-rate"}];s.push(...e)}e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(6),n=i(7),r=i(9);e.default=class{constructor(){this._tractUI=new s.default,this._glottisUI=new n.default,this._buttonsUI=new r.default,this._container=document.createElement("div"),this._container.style.height="100%",this._container.style.width="100%",this._container.style.display="grid",this._container.style.gridTemplateRows="auto 200px 100px",this._container.style.gridTemplateColumns="auto 100px",this._container.style.gridRowGap="5px",this._container.appendChild(this._tractUI.node),this._tractUI.node.id="tractUI",this._tractUI.node.style.gridColumn="1 / span 2",this._tractUI.node.style.gridRow="1 / span 2",this._container.appendChild(this._glottisUI.node),this._glottisUI.node.id="glottisUI",this._glottisUI.node.style.gridColumn="1 / span 2",this._glottisUI.node.style.gridRow="3",this._container.appendChild(this._buttonsUI.node),this._buttonsUI.node.id="buttonsUI",this._buttonsUI.node.style.zIndex="1",this._buttonsUI.node.style.gridColumn="2",this._buttonsUI.node.style.gridRow="2",this._container.addEventListener("message",t=>{t.stopPropagation(),Array.from(this._container.children).forEach(e=>{e!==t.target&&e.dispatchEvent(new CustomEvent("message",{detail:t.detail}))})})}get node(){return this._container}show(){this.node.style.display="grid"}hide(){this.node.style.display="none"}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(){this._container=document.createElement("div"),this._container.style.margin="0",this._container.style.padding="0",this._canvases={},this._contexts={},["tract","background"].forEach((t,e)=>{const i=document.createElement("canvas");i.id=t,i.style.position="absolute",i.height=500,i.width=600,i.style.backgroundColor="transparent",i.style.margin="0",i.style.padding="0",i.style.zIndex=String(1-e),this._canvases[t]=i,this._contexts[t]=i.getContext("2d"),this._container.appendChild(i)}),this._canvas=this._canvases.tract,this._context=this._contexts.tract,this._tract={origin:{x:340,y:460},radius:298,scale:60,scalar:1,angle:{scale:.64,offset:-.25}},this._processor=null,this._parameters={},this._touchConstrictionIndices=[],this._container.addEventListener("animationFrame",t=>{this._container.dispatchEvent(new CustomEvent("getProcessor",{bubbles:!0})),this._container.dispatchEvent(new CustomEvent("getParameter",{bubbles:!0,detail:{parameterName:"intensity"}}))}),this._container.addEventListener("didGetProcessor",t=>{this._processor=t.detail.processor,this._resize(),this._drawTract()}),this._container.addEventListener("didGetParameter",t=>{const e=t.detail.parameterName,i=t.detail.value;this._parameters[e]=i});new MutationObserver((t,e)=>{document.contains(this._container)&&(this._container.dispatchEvent(new CustomEvent("requestAnimationFrame",{bubbles:!0})),e.disconnect())}).observe(document.body,{subtree:!0,childList:!0}),this._canvases.tract.addEventListener("mousedown",t=>{this._startEvent(t)}),this._canvases.tract.addEventListener("mousemove",t=>{this._moveEvent(t)}),this._canvases.tract.addEventListener("mouseup",t=>{this._endEvent(t)}),this._canvases.tract.addEventListener("touchstart",t=>{t.preventDefault(),Array.from(t.changedTouches).forEach(t=>this._startEvent(t))}),this._canvases.tract.addEventListener("touchmove",t=>{t.preventDefault(),Array.from(t.changedTouches).forEach(t=>this._moveEvent(t))}),this._canvases.tract.addEventListener("touchend",t=>{t.preventDefault(),Array.from(t.changedTouches).forEach(t=>this._endEvent(t))}),this._canvases.tract.addEventListener("touchcancel",t=>{t.preventDefault(),Array.from(t.changedTouches).forEach(t=>this._endEvent(t))}),this._canvases.tract.addEventListener("didNewConstriction",t=>{this._touchConstrictionIndices[t.detail.touchIdentifier]=t.detail.constrictionIndex}),this._canvases.tract.addEventListener("didRemoveConstriction",t=>{this._touchConstrictionIndices[t.detail.touchIdentifier]=void 0})}get node(){return this._container}get width(){return this._container.offsetWidth}get height(){return this._container.offsetHeight}_resize(){this._tract.scalar=this._canvases.tract.width/this._canvases.tract.offsetWidth,this._resizeCanvases()}_resizeCanvases(){for(let t in this._canvases)this._canvases[t].style.height=String(this._container.offsetHeight)}_drawTract(){if(this._isDrawing)return;const t=this._context;this._isDrawing=!0,this._context=this._contexts.tract,t.clearRect(0,0,this._canvas.width,this._canvas.height),t.lineCap=t.lineJoin="round",this._drawTongueControl(),t.beginPath(),t.lineWidth=2,t.strokeStyle=t.fillStyle="pink",this._moveTo(1,0);for(let t=1;t<this._processor.tract.length;t++)this._lineTo(t,this._processor.tract.diameter[t]);for(let t=this._processor.tract.length-1;t>=2;t--)this._lineTo(t,0);t.closePath(),t.stroke(),t.fill();const e=this._processor.tract.nose.diameter[0],i=4*e;t.beginPath(),t.lineWidth=2,t.strokeStyle=t.fillStyle="pink",this._moveTo(this._processor.tract.nose.start,-this._processor.tract.nose.offset);for(let t=1;t<this._processor.tract.nose.length;t++)this._lineTo(t+this._processor.tract.nose.start,-this._processor.tract.nose.offset-.9*this._processor.tract.nose.diameter[t]);for(let t=this._processor.tract.nose.length-1;t>=1;t--)this._lineTo(t+this._processor.tract.nose.start,-this._processor.tract.nose.offset);t.closePath(),t.fill(),t.beginPath(),t.lineWidth=2,t.strokeStyle=t.fillStyle="pink",this._moveTo(this._processor.tract.nose.start-2,0),this._lineTo(this._processor.tract.nose.start,-this._processor.tract.nose.offset),this._lineTo(this._processor.tract.nose.start+i,-this._processor.tract.nose.offset),this._lineTo(this._processor.tract.nose.start+i-2,0),t.closePath(),t.stroke(),t.fill(),t.fillStyle="white",t.font="20px Arial",t.textAlign="center",t.globalAlpha=1,this._drawText(.1*this._processor.tract.length,.425,"throat",!1),this._drawText(.71*this._processor.tract.length,-1.8,"nasal",!1),this._drawText(.71*this._processor.tract.length,-1.3,"cavity",!1),t.font="22px Arial",this._drawText(.6*this._processor.tract.length,.9,"oral",!1),this._drawText(.7*this._processor.tract.length,.9,"cavity",!1),this._drawAmplitudes(),t.beginPath(),t.lineWidth=5,t.strokeStyle="#C070C6",t.lineJoin=t.lineCap="round",this._moveTo(1,this._processor.tract.diameter[0]);for(let t=2;t<this._processor.tract.length;t++)this._lineTo(t,this._processor.tract.diameter[t]);this._moveTo(1,0);for(let t=2;t<=this._processor.tract.nose.start-2;t++)this._lineTo(t,0);this._moveTo(this._processor.tract.nose.start+i-2,0);for(let t=this._processor.tract.nose.start+Math.ceil(i)-2;t<this._processor.tract.length;t++)this._lineTo(t,0);t.stroke(),t.beginPath(),t.lineWidth=5,t.strokeStyle="#C070C6",t.lineJoin="round",this._moveTo(this._processor.tract.nose.start,-this._processor.tract.nose.offset);for(let t=1;t<this._processor.tract.nose.length;t++)this._lineTo(t+this._processor.tract.nose.start,-this._processor.tract.nose.offset-.9*this._processor.tract.nose.diameter[t]);this._moveTo(this._processor.tract.nose.start+i,-this._processor.tract.nose.offset);for(let t=Math.ceil(i);t<this._processor.tract.nose.length;t++)this._lineTo(t+this._processor.tract.nose.start,-this._processor.tract.nose.offset);t.stroke(),t.globalAlpha=5*e,t.beginPath(),this._moveTo(this._processor.tract.nose.start-2,0),this._lineTo(this._processor.tract.nose.start,-this._processor.tract.nose.offset),this._lineTo(this._processor.tract.nose.start+i,-this._processor.tract.nose.offset),this._lineTo(this._processor.tract.nose.start+i-2,0),t.stroke(),t.fillStyle="orchid",t.font="20px Arial",t.textAlign="center",t.globalAlpha=.7,this._drawText(.95*this._processor.tract.length,.8+.8*this._processor.tract.diameter[this._processor.tract.length-1]," lip",!1),t.globalAlpha=1,t.fillStyle="black",t.textAlign="left",this._drawPositions(),this._isDrawing=!1}_drawCircle(t,e,i){const s=this._getAngle(t),n=this._getRadius(t,e),r=this._context;r.beginPath(),r.arc(this._getX(s,n),this._getY(s,n),i,0,2*Math.PI),r.fill()}_drawTongueControl(){const t=this._context;t.lineCap=t.lineJoin="round",t.strokeStyle=t.fillStyle="#FFEEF5",t.globalAlpha=1,t.beginPath(),t.lineWidth=45,this._moveTo(this._processor.tract.tongue.range.index.minValue,this._processor.tract.tongue.diameter.minValue);for(let t=this._processor.tract.tongue.range.index.minValue+1;t<=this._processor.tract.tongue.range.maxValue;t++)this._lineTo(t,this._processor.tract.tongue.range.diameter.minValue);this._lineTo(this._processor.tract.tongue.range.index.center,this._processor.tract.tongue.range.diameter.maxValue),t.closePath(),t.stroke(),t.fill(),t.fillStyle="orchid",t.globalAlpha=.3,[0,-4.25,-8.5,4.25,8.5,-6.1,6.1,0,0].forEach((t,e)=>{const i=e<5?this._processor.tract.tongue.range.diameter.minValue:e<8?this._processor.tract.tongue.range.diameter.center:this._processor.tract.tongue.range.diameter.maxValue;this._drawCircle(this._processor.tract.tongue.range.index.center+t,i,3)});const e=this._getAngle(this._processor.tract.tongue.index),i=this._getRadius(this._processor.tract.tongue.index,this._processor.tract.tongue.diameter);t.lineWidth=4,t.strokeStyle="orchid",t.globalAlpha=.7,t.beginPath(),t.arc(this._getX(e,i),this._getY(e,i),18,0,2*Math.PI),t.stroke(),t.globalAlpha=.15,t.fill(),t.globalAlpha=1,t.fillStyle="orchid"}_drawAmplitudes(){const t=this._context;t.strokeStyle="orchid",t.lineCap="butt",t.globalAlpha=.3;for(let e=2;e<this._processor.tract.length-1;e++)t.beginPath(),t.lineWidth=3*Math.sqrt(this._processor.tract.amplitude.max[e]),this._moveTo(e,0),this._lineTo(e,this._processor.tract.diameter[e]),t.stroke();for(let e=1;e<this._processor.tract.nose.length-1;e++)t.beginPath(),t.lineWidth=3*Math.sqrt(this._processor.tract.nose.amplitude.max[e]),this._moveTo(this._processor.tract.nose.start+e,-this._processor.tract.nose.offset),this._lineTo(this._processor.tract.nose.start+e,-this._processor.tract.nose.offset-.9*this._processor.tract.nose.diameter[e]),t.stroke();t.globalAlpha=1}_drawPositions(){const t=this._context;t.fillStyle="orchid",t.font="24px Arial",t.textAlign="center",t.globalAlpha=.6,[[15,.6,"æ"],[13,.27,"a"],[12,0,"ɒ"],[17.7,.05,"(ɔ)"],[27,.65,"ɪ"],[27.4,.21,"i"],[20,1,"e"],[18.1,.37,"ʌ"],[23,.1,"(u)"],[21,.6,"ə"]].forEach(t=>{const e=t[0],i=1.5*t[1]+2,s=t[2];this._drawText(e,i,s,!1)}),t.globalAlpha=.8;this._drawText(38,1.1,"l",!1),this._drawText(41,1.1,"w",!1),this._drawText(4.5,.37,"h",!1);const e=this._parameters.intensity>0?["ʒ","z","v","g","d","b"]:["ʃ","s","f","k","t","p"];e.push("ŋ","n","m");[31.5,36,41,22,36,41,22,36,41].forEach((t,i)=>{const s=i<4?.3:i<6?-.4:-1.1;this._drawText(t,s,e[i],!1)})}_drawText(t,e,i,s=!0){const n=this._getAngle(t),r=this._getRadius(t,e),o=this._context;o.save(),o.translate(this._getX(n,r),this._getY(n,r)+2),s||o.rotate(n-Math.PI/2),o.fillText(String(i),0,0),o.restore()}_moveTo(t,e){this.__to(t,e,!0)}_lineTo(t,e){this.__to(t,e,!1)}__to(t,e,i=!0){const s=this._getWobble(t),n=this._getAngle(t)+s,r=this._getRadius(t,e)+100*s,o=this._context,a=this._getX(n,r),c=this._getY(n,r);i?o.moveTo(a,c):o.lineTo(a,c)}_getX(t,e){return this._tract.origin.x-e*Math.cos(t)}_getY(t,e){return this._tract.origin.y-e*Math.sin(t)}_getAngle(t){return this._tract.angle.offset+t*this._tract.angle.scale*Math.PI/(this._processor.tract.lip.start-1)}_getWobble(t){var e=this._processor.tract.amplitude.max[this._processor.tract.length-1]+this._processor.tract.nose.amplitude.max[this._processor.tract.nose.length-1];return e*=.03*Math.sin(2*t-Date.now()/1e3*50)*t/this._processor.tract.length}_getRadius(t,e){return this._tract.radius-this._tract.scale*e}_getIndex(t,e){for(var i=Math.atan2(e,t);i>0;)i-=2*Math.PI;return(Math.PI+i-this._tract.angle.offset)*(this._processor.tract.lip.start-1)/(this._tract.angle.scale*Math.PI)}_getDiameter(t,e){return(this._tract.radius-Math.sqrt(Math.pow(t,2)+Math.pow(e,2)))/this._tract.scale}_isNearTongue(t,e){var i=!0;return i=(i=i&&this._processor.tract.tongue.range.index.minValue-4<=t&&t<=this._processor.tract.tongue.range.index.maxValue+4)&&this._processor.tract.tongue.range.diameter.minValue-.5<=e&&e<=this._processor.tract.tongue.range.diameter.maxValue+.5}_getEventX(t){return(t.pageX-t.target.offsetLeft)*this._tract.scalar-this._tract.origin.x}_getEventY(t){return(t.pageY-t.target.offsetTop)*this._tract.scalar-this._tract.origin.y}_getEventPosition(t){const e=this._getEventX(t),i=this._getEventY(t);return{index:this._getIndex(e,i),diameter:this._getDiameter(e,i)}}_setTongue(t,e){Object.keys(e).forEach(i=>{t.target.dispatchEvent(new CustomEvent("setParameter",{bubbles:!0,detail:{parameterName:"tongue."+i,newValue:e[i]}}))})}_getTouchIdentifier(t){return void 0!==window.Touch&&t instanceof Touch?t.identifier:-1}_startEvent(t){const e=this._getTouchIdentifier(t);if(null==this._touchConstrictionIndices[e]){const i=this._getEventPosition(t);this._isNearTongue(i.index,i.diameter)?(this._touchConstrictionIndices[e]=-1,this._setTongue(t,i)):t.target.dispatchEvent(new CustomEvent("newConstriction",{bubbles:!0,detail:{touchIdentifier:e,index:i.index,diameter:i.diameter}}))}}_moveEvent(t){const e=this._getTouchIdentifier(t);if(void 0!==this._touchConstrictionIndices[e]){const i=this._getEventPosition(t),s=this._touchConstrictionIndices[e];-1==s?this._setTongue(t,i):t.target.dispatchEvent(new CustomEvent("setConstriction",{bubbles:!0,detail:{constrictionIndex:s,index:i.index,diameter:i.diameter}}))}}_endEvent(t){const e=this._getTouchIdentifier(t);if(void 0!==this._touchConstrictionIndices[e]){const i=this._touchConstrictionIndices[e];-1==i||t.target.dispatchEvent(new CustomEvent("removeConstriction",{bubbles:!0,detail:{constrictionIndex:i,touchIdentifier:e}})),this._touchConstrictionIndices[e]=void 0}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(8);e.default=class{constructor(){this._frequency={min:20,max:1e3,get range(){return this.max-this.min},interpolate(t){return this.min+this.range*t}},this._isActive=!1,this._alwaysVoice=!0,this._container=document.createElement("div"),this._container.style.border="solid red 1px",this._container.style.backgroundColor="pink",this._container.style.borderRadius="20px",this._slider=document.createElement("div"),this._slider.style.position="relative",this._slider.style.flex="0",this._slider.style.width="20px",this._slider.style.height="20px",this._slider.style.borderRadius="20px",this._slider.style.border="solid red 5px",this._slider.style.top="50%",this._slider.style.left="50%",this._container.appendChild(this._slider),this._container.addEventListener("mousedown",t=>{this._isActive=!0,this._eventCallback(t),this._alwaysVoice||this._container.dispatchEvent(new CustomEvent("setParameter",{bubbles:!0,detail:{parameterName:"intensity",newValue:1}}))}),this._container.addEventListener("mousemove",t=>{this._eventCallback(t)}),this._container.addEventListener("mouseup",t=>{this._isActive=!1,0==this._alwaysVoice&&this._container.dispatchEvent(new CustomEvent("setParameter",{bubbles:!0,detail:{parameterName:"intensity",newValue:0}}))}),this._container.addEventListener("touchstart",t=>{if(t.preventDefault(),!this._isActive){this._isActive=!0;const e=t.changedTouches[0];this._touchIdentifier=e.identifier,this._eventCallback(e),this._alwaysVoice||this._container.dispatchEvent(new CustomEvent("setParameter",{bubbles:!0,detail:{parameterName:"intensity",newValue:1}}))}}),this._container.addEventListener("touchmove",t=>{t.preventDefault();const e=Array.from(t.changedTouches).find(t=>t.identifier==this._touchIdentifier);void 0!==e&&this._eventCallback(e)}),this._container.addEventListener("touchend",t=>{t.preventDefault(),this._isActive&&Array.from(t.changedTouches).some(t=>t.identifier==this._touchIdentifier)&&(this._isActive=!1,this._touchIdentifier=-1),this._alwaysVoice||this._container.dispatchEvent(new CustomEvent("setParameter",{bubbles:!0,detail:{parameterName:"intensity",newValue:0}}))}),this._container.addEventListener("message",t=>{"toggleButton"==t.detail.type&&"voice"==t.detail.parameterName&&(this._alwaysVoice="true"==t.detail.newValue)});new MutationObserver((t,e)=>{if(document.contains(this._container)){const t=new CustomEvent("requestAnimationFrame",{bubbles:!0});this._container.dispatchEvent(t),e.disconnect()}}).observe(document.body,{subtree:!0,childList:!0}),this._container.addEventListener("animationFrame",t=>{["frequency","tenseness"].forEach(e=>{const i=new CustomEvent("getParameter",{bubbles:!0,detail:{parameterName:e,render:!0}});t.target.dispatchEvent(i)})}),this._container.addEventListener("didGetParameter",t=>{if(1==t.detail.render){const n=t.detail.parameterName,r=t.detail.value;var e;if(["frequency","tenseness"].includes(n))"frequency"==n?(i=(r-this._frequency.min)/this._frequency.range,e=s.default(i,0,1),this._slider.style.left=String(e*this._container.offsetWidth-this._slider.offsetWidth/2)):(e=1-Math.acos(1-r)/(.5*Math.PI),this._slider.style.top=String(e*this._container.offsetHeight-this._slider.offsetHeight/2))}var i})}get node(){return this._container}_eventCallback(t){if(this._isActive){const e={vertical:s.default((t.pageY-this._container.offsetTop)/this._container.offsetHeight,0,.99),horizontal:s.default((t.pageX-this._container.offsetLeft)/this._container.offsetWidth,0,.99)},i=this._frequency.interpolate(e.horizontal),n=1-Math.cos((1-e.vertical)*Math.PI*.5),r={frequency:i,tenseness:n,loudness:Math.pow(n,.25)};Object.keys(r).forEach(t=>{this._container.dispatchEvent(new CustomEvent("setParameter",{bubbles:!0,detail:{parameterName:t,newValue:r[t]}}))})}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,i){return t<=e?e:t<i?t:i}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(){this._container=document.createElement("div"),this._container.style.display="flex",this._container.style.flexDirection="column",this._buttons={start:this._createButton("start"),wobble:this._createButton("wobble",!0,"vibrato.wobble"),voice:this._createButton("voice",!0,"intensity")},this._buttons.start.addEventListener("didResume",t=>{t.target.parentElement.removeChild(t.target)}),this._buttons.start.addEventListener("click",t=>{t.target.dispatchEvent(new CustomEvent("resume",{bubbles:!0}))})}get node(){return this._container}_createButton(t,e=!1,i){const s=document.createElement("button");return s.id=t,s.value="true",s.innerText=(e?"disable":"")+t,s.style.width="100%",s.style.flex="1",s.style.margin="2px",s.style.borderRadius="20px",s.style.backgroundColor="pink",s.style.border="solid red",this._container.appendChild(s),e&&s.addEventListener("click",e=>{s.value="false"==s.value;const n="true"==s.value?"disable":"enable";s.innerText=n+" "+s.id,s.dispatchEvent(new CustomEvent("setParameter",{bubbles:!0,detail:{parameterName:i||t,newValue:"true"==s.value?1:0}})),s.dispatchEvent(new CustomEvent("message",{bubbles:!0,detail:{type:"toggleButton",parameterName:t,newValue:s.value}}))}),s}}}]);