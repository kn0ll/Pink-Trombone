!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,i){return t<=e?e:t<i?t:i}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(2),n=i(3);class o extends AudioWorkletProcessor{constructor(){super(),this.processor=new n.default,this.enabledConstrictionIndices=[],this.port.onmessage=t=>{switch(t.data.name){case"enableConstriction":this.enabledConstrictionIndices[t.data.constrictionIndex]=!0,this.port.postMessage(t.data);break;case"disableConstriction":this.enabledConstrictionIndices[t.data.constrictionIndex]=!1,this.port.postMessage(t.data);break;case"enabledConstrictionIndices":t.data.enabledConstrictionIndices=this.enabledConstrictionIndices,this.port.postMessage(t.data);break;case"getProcessor":t.data.processor=JSON.stringify(this.processor),this.port.postMessage(t.data)}}}static get parameterDescriptors(){return s.default}_getParameterSamples(t,e){const i={};for(let s=0;s<o.parameterDescriptors.length;s++){const n=o.parameterDescriptors[s];n.name.includes("constriction")||(i[n.name]=1==t[n.name].length?t[n.name][0]:t[n.name][e])}return i}_getConstrictions(t){const e=[];for(let i=0;i<s.numberOfConstrictions;i++)if(this.enabledConstrictionIndices[i]){const s="constriction"+i,n={index:t[s+"index"][0],diameter:t[s+"diameter"][0]};e[i]=n}return e}process(t,e,i){const s=this._getConstrictions(i);for(let t=0;t<e.length;t++)for(let s=0;s<e[t].length;s++)for(let n=0;n<e[t][s].length;n++){const o=this._getParameterSamples(i,n),r=currentTime+n/sampleRate,h=this.processor.process(o,n,e[t][s].length,r);e[t][s][n]=h}return this.processor.update(currentTime+e[0][0].length/sampleRate,s),!0}}registerProcessor("pink-trombone-worklet-processor",o)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.numberOfConstrictions=void 0;const s=[{name:"noise",defaultValue:0,minValue:-1,maxValue:1},{name:"frequency",defaultValue:140,minValue:0},{name:"tenseness",defaultValue:.6,minValue:0,maxValue:1},{name:"intensity",defaultValue:1,minValue:0,maxValue:1},{name:"loudness",defaultValue:1,minValue:0,maxValue:1},{name:"tongueIndex",defaultValue:12.9},{name:"tongueDiameter",defaultValue:2.43},{name:"vibratoWobble",defaultValue:1,minValue:0,maxValue:1},{name:"vibratoFrequency",defaultValue:6,minValue:0},{name:"vibratoGain",defaultValue:.005,minValue:0}];e.numberOfConstrictions=4;for(let t=0;t<e.numberOfConstrictions;t++){const e=[{name:"constriction"+t+"index",defaultValue:0,automationRate:"k-rate"},{name:"constriction"+t+"diameter",defaultValue:0,automationRate:"k-rate"}];s.push(...e)}e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(4),n=i(6);e.default=class{constructor(){this.glottis=new s.default,this.tract=new n.default}process(t,e,i,s){var n=0;const o=this.glottis.process(...arguments);return t.glottis=o,n+=this.tract.process(...arguments),e+=.5,n+=this.tract.process(t,e,i,s),n*=.125}update(t,e){this.glottis.update(),this.tract.update(t,e)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(5);e.default=class{constructor(){this.noise=new n.default,this.coefficients={alpha:0,Delta:0,E0:0,epsilon:0,omega:0,shift:0,Te:0},this.startSeconds=0}process(t,e,i,s){const n=t.intensity,o=t.loudness;var r=0;if(r+=t.vibratoGain*Math.sin(2*Math.PI*s*t.vibratoFrequency),r+=.02*this.noise.simplex1(4.07*s),r+=.04*this.noise.simplex1(2.15*s),t.vibratoWobble>0){var h=0;h+=.2*this.noise.simplex1(.98*s),r+=(h+=.4*this.noise.simplex1(.5*s))*t.vibratoWobble}var a=t.frequency;a*=1+r;var l=t.tenseness;l+=.1*this.noise.simplex1(.46*s),l+=.05*this.noise.simplex1(.36*s),l+=(3-l)*(1-n);const c=1/a;var u=s-this.startSeconds,f=u/c;f>=1&&(this.startSeconds=s+u%c,f=this.startSeconds/c,this._updateCoefficients(l));var d=0,p=this._getNoiseModulator(f);p+=3*(1-l*n),t.noiseModulator=p;var m=t.noise;m*=p,m*=n,m*=n,m*=1-Math.sqrt(Math.max(l,0)),m*=.02*this.noise.simplex1(1.99*s)+.2;var g=this._getNormalizedWaveform(f);return g*=n,d=m+(g*=o),d*=n}update(){}_updateCoefficients(t=0){const e=s.default(3*(1-t),.5,2.7),i=.048*e-.01,n=.224+.118*e,o=1/(2*(n/4*(.5+1.2*n)/(.11*e-i*(.5+1.2*n)))),r=o+o*n;this.coefficients.epsilon=1/i,this.coefficients.shift=Math.exp(-this.coefficients.epsilon*(1-r)),this.coefficients.Delta=1-this.coefficients.shift;const h=-(-(r-o)/2+(1/this.coefficients.epsilon*(this.coefficients.shift-1)+(1-r)*this.coefficients.shift)/this.coefficients.Delta);this.coefficients.omega=Math.PI/o;const a=Math.sin(this.coefficients.omega*r),l=-Math.PI*a*h/(2*o),c=Math.log(l);this.coefficients.alpha=c/(o/2-r),this.coefficients.E0=-1/(a*Math.exp(this.coefficients.alpha*r)),this.coefficients.Te=r}_getNormalizedWaveform(t){return t>this.coefficients.Te?(-Math.exp(-this.coefficients.epsilon*(t-this.coefficients.Te))+this.coefficients.shift)/this.coefficients.Delta:this.coefficients.E0*Math.exp(this.coefficients.alpha*t)*Math.sin(this.coefficients.omega*t)}_getNoiseModulator(t){const e=2*Math.PI*t,i=Math.sin(e);return.2*Math.max(0,i)+.1}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t,e,i){this.dot2=(t,e)=>this.x*t+this.y*e,this.dot3=(t,e,i)=>this.dot2(t,e)+this.z*i,this.x=t,this.y=e,this.z=i}}e.default=class{constructor(){this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]].map(t=>new s(...t)),this.p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this.perm=new Array(Math.pow(2,9)),this.gradP=new Array(Math.pow(2,9)),this.F2=.5*(Math.sqrt(3)-1),this.G2=(3-Math.sqrt(3))/6,this.F3=1/3,this.G3=1/6,this.seed(Date.now())}seed(t){t>0&&t<1&&(t*=Math.pow(2,16)),(t=Math.floor(t))<Math.pow(2,8)&&(t|=t<<Math.pow(2,3));for(let e=0;e<Math.pow(2,8);e++){const i=1&e?0:Math.pow(2,3),s=this.p[e]^t>>i&Math.pow(2,8)-1;this.perm[e]=this.perm[e+Math.pow(2,8)]=s,this.gradP[e]=this.gradP[e+Math.pow(2,8)]=this.grad3[s%this.grad3.length]}}simplex2(t,e){const i=(t+e)*this.F2;var s=Math.floor(t+i),n=Math.floor(e+i);const o=(s+n)*this.G2,r=t-s+o,h=e-n+o,a=r>h?1:0,l=1-a,c=r-a+this.G2,u=h-l+this.G2,f=r-1+2*this.G2,d=h-1+2*this.G2;s&=Math.pow(2,8)-1,n&=Math.pow(2,8)-1;const p=this.gradP[s+this.perm[n]],m=this.gradP[s+a+this.perm[n+l]],g=this.gradP[s+1+this.perm[n+1]],M=.5-Math.pow(r,2)-Math.pow(h,2),x=M<0?0:Math.pow(M,4)*p.dot2(r,h),w=.5-Math.pow(c,2)-Math.pow(u,2),v=w<0?0:Math.pow(w,4)*m.dot2(c,u),b=.5-Math.pow(f,2)-Math.pow(d,2);return 70*(x+v+(b<0?0:Math.pow(b,4)*g.dot2(f,d)))}simplex1(t){return this.simplex2(1.2*t,-.7*t)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(7),o=i(8),r=i(9);e.default=class{constructor(t=44){this.length=t,this.blade={start:Math.floor(10*this.length/44)},this.tip={start:Math.floor(32*this.length/44)},this.lip={start:Math.floor(39*this.length/44),reflection:-.85},this.glottis={reflection:.75},this.velum={target:.01},this.grid={offset:1.7},this.right=new Float64Array(this.length),this.right.junction=new Float64Array(this.length+1),this.right.reflection={value:0,new:0},this.left=new Float64Array(this.length),this.left.junction=new Float64Array(this.length+1),this.left.reflection={value:0,new:0},this.reflection=new Float64Array(this.length+1),this.reflection.new=new Float64Array(this.length+1),this.amplitude=new Float64Array(this.length),this.amplitude.max=new Float64Array(this.length),this.diameter=new Float64Array(this.length),this.diameter.rest=new Float64Array(this.length),this.tongue={_diameter:2.43,_index:12.9,range:{diameter:{minValue:2.05,maxValue:3.5,get range(){return this.maxValue-this.minValue},get center(){return(this.maxValue+this.minValue)/2},interpolation(t){const e=(t-this.minValue)/this.range;return s.default(e,0,1)}},index:{minValue:this.blade.start+2,maxValue:this.tip.start-3,get range(){return this.maxValue-this.minValue},get center(){return(this.maxValue+this.minValue)/2},centerOffset(t){return t*this.range/2}}},get diameter(){return this._diameter},set diameter(t){this._diameter=s.default(t,this.range.diameter.minValue,this.range.diameter.maxValue)},get index(){return this._index},set index(t){const e=1-this.range.diameter.interpolation(this.diameter),i=Math.pow(e,.58)-.2*(Math.pow(e,2)-e),n=this.range.index.centerOffset(i);this._index=s.default(t,this.range.index.center-n,this.range.index.center+n)}},this.nose=new o.default(this),this.transients=[],this.transients.obstruction={last:-1,new:-1},this.previousConstrictions=[],this.previousConstrictions.tongue={};for(let t=0;t<this.length;t++){var e=0;e=t<7*this.length/44-.5?.6:t<12*this.length/44?1.1:1.5,this.diameter[t]=e,this.diameter.rest[t]=e}this._updateReflection()}process(t,e,i,s){this.tongue.diameter=t.tongueDiameter,this.tongue.index=t.tongueIndex,this._processTransients(s),this._processConstrictions(this.previousConstrictions,t);const n=e/i,o=Math.random()<.1;var r=0;return r+=this._processLips(t,n,o),r+=this._processNose(t,n,o),isNaN(r)&&this.reset(),r}_processTransients(t){for(let e=this.transients.length-1;e>=0;e--){const i=this.transients[e];this.left[i.position]+=i.amplitude,i.update(t),i.isAlive||this.transients.splice(e,1)}}_processConstrictions(t,e){for(let n=0;n<t.length;n++){const o=t[n];if(o.index>=2&&o.index<=this.length&&o.diameter>0){var i=e.glottis;i*=.66*e.noiseModulator;i*=s.default(8*(.7-o.diameter),0,1)*s.default(30*(o.diameter-.3),0,1)/2;const t=Math.floor(o.index),n=i*(o.index-t),r=t+1,h=i*(r-o.index);this.right[t+1]+=n,this.right[r+1]+=h,this.left[t+1]+=n,this.left[r+1]+=h}}}_processLips(t,e,i){this.right.junction[0]=this.left[0]*this.glottis.reflection+t.glottis,this.left.junction[this.length]=this.right[this.length-1]*this.lip.reflection;for(let t=1;t<this.length;t++){const i=n.default(e,this.reflection[t],this.reflection.new[t])*(this.right[t-1]+this.left[t]);this.right.junction[t]=this.right[t-1]-i,this.left.junction[t]=this.left[t]+i}const s=n.default(e,this.left.reflection.new,this.left.reflection.value);this.left.junction[this.nose.start]=s*this.right[this.nose.start-1]+(s+1)*(this.nose.left[0]+this.left[this.nose.start]);const o=n.default(e,this.right.reflection.new,this.right.reflection.value);this.right.junction[this.nose.start]=o*this.left[this.nose.start]+(o+1)*(this.nose.left[0]+this.right[this.nose.start-1]);const r=n.default(e,this.nose.reflection.new,this.nose.reflection.value);this.nose.right.junction[0]=r*this.nose.left[0]+(r+1)*(this.left[this.nose.start]+this.right[this.nose.start-1]);for(let t=0;t<this.length;t++)if(this.right[t]=.999*this.right.junction[t],this.left[t]=.999*this.left.junction[t+1],i){const e=Math.abs(this.left[t]+this.right[t]);this.amplitude.max[t]=e>this.amplitude.max[t]?e:.999*this.amplitude.max[t]}return this.right[this.length-1]}_processNose(t,e,i){this.nose.left.junction[this.nose.length]=this.nose.right[this.nose.length-1]*this.lip.reflection;for(let t=1;t<this.nose.length;t++){const e=this.nose.reflection[t]*(this.nose.left[t]+this.nose.right[t-1]);this.nose.left.junction[t]=this.nose.left[t]+e,this.nose.right.junction[t]=this.nose.right[t-1]-e}for(let t=0;t<this.nose.length;t++)if(this.nose.left[t]=this.nose.left.junction[t+1]*this.nose.fade,this.nose.right[t]=this.nose.right.junction[t]*this.nose.fade,i){const e=Math.abs(this.nose.left[t]+this.nose.right[t]);this.nose.amplitude.max[t]=e>this.nose.amplitude.max[t]?e:.999*this.nose.amplitude.max[t]}return this.nose.right[this.nose.length-1]}update(t,e){this._updateTract(),this._updateTransients(t),this.nose.diameter[0]=this.velum.target,this.nose.amplitude[0]=Math.pow(this.nose.diameter[0],2),this._updateReflection(),this._updateConstrictions(e)}_updateDiameterRest(){for(let e=this.blade.start;e<this.lip.start;e++){const i=(this.tongue.index-e)/(this.tip.start-this.blade.start),s=1.1*Math.PI*i;var t=(1.5-(2+(this.tongue.diameter-2)/1.5)+this.grid.offset)*Math.cos(s);e!=this.blade.start-2&&e!=this.lip.start-1||(t*=.8),e!=this.blade.start+0&&e!=this.lip.start-2||(t*=.94);const n=1.5-t;this.diameter.rest[e]=n}}_updateConstrictions(t){var e=!1;e=e||this.tongue.index!==this.previousConstrictions.tongue.index||this.tongue.diameter!==this.previousConstrictions.tongue.diameter;const i=Math.max(this.previousConstrictions.length,t.length);for(let s=0,n=t[0],o=this.previousConstrictions[0];!e&&s<i;s++,n=t[s],o=this.previousConstrictions[s])e=void 0!==n&&void 0!==o?n.index!==o.index||n.diameter!==o.diameter:!(null==n&&null==o);if(e){this._updateDiameterRest();for(let t=0;t<this.length;t++)this.diameter[t]=this.diameter.rest[t];this.velum.target=.01;for(let e=-1;e<t.length;e++){const i=t[e]||this.tongue;if(i.index>this.nose.start&&i.diameter<-this.nose.offset&&(this.velum.target=.4),i.index>=2&&i.index<this.length&&i.diameter>-(.85+this.nose.offset)){var s=i.diameter;if(s-=.3,(s=Math.max(0,s))<3){var n=2;n=i.index<25?10:i.index>=this.tip.start?5:10-5*(i.index-25)/(this.tip.start-25);const t=Math.round(i.index);for(let e=t-(Math.ceil(n)+1);e<t+n+1&&e>=0&&e<this.length;e++){const t=Math.abs(e-i.index)-.5;var o;o=t<=0?0:t>n?1:.5*(1-Math.cos(Math.PI*t/n));const r=this.diameter[e]-s;r>0&&(this.diameter[e]=s+r*o)}}}}this.previousConstrictions=t,this.previousConstrictions.tongue={index:this.tongue.index,diameter:this.tongue.diameter}}}_updateTract(){for(let t=0;t<this.length;t++)this.diameter[t]<=0&&(this.transients.obstruction.new=t)}_updateTransients(t){this.nose.amplitude[0]<.05&&(this.transients.obstruction.last>-1&&-1==this.transients.obstruction.new&&this.transients.push(new r.default(this.transients.obstruction.new,t)),this.transients.obstruction.last=this.transients.obstruction.new)}_updateReflection(){for(let t=0;t<this.length;t++)this.amplitude[t]=Math.pow(this.diameter[t],2),t>0&&(this.reflection[t]=this.reflection.new[t],this.reflection.new[t]=0==this.amplitude[t]?.999:(this.amplitude[t-1]-this.amplitude[t])/(this.amplitude[t-1]+this.amplitude[t]));const t=this.amplitude[this.nose.start]+this.amplitude[this.nose.start+1]+this.nose.amplitude[0];this.left.reflection.value=this.left.reflection.new,this.left.reflection.new=(2*this.amplitude[this.nose.start]-t)/t,this.right.reflection.value=this.right.reflection.new,this.right.reflection.new=(2*this.amplitude[this.nose.start+1]-t)/t,this.nose.reflection.value=this.nose.reflection.new,this.nose.reflection.new=(2*this.nose.amplitude[0]-t)/t}reset(){this.right.fill(0),this.right.junction.fill(0),this.left.fill(0),this.left.junction.fill(0),this.nose.left.fill(0),this.nose.left.junction.fill(0),this.nose.right.fill(0),this.nose.right.junction.fill(0)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);e.default=function(t,e,i){return e*(1-(t=s.default(t,0,1)))+i*t}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this.length=Math.floor(28*t.length/44),this.start=t.length-this.length+1,this.fade=1,this.offset=.8,this.left=new Float64Array(this.length),this.left.junction=new Float64Array(this.length+1),this.right=new Float64Array(this.length),this.right.junction=new Float64Array(this.length+1),this.reflection=new Float64Array(this.length+1),this.reflection.value=0,this.reflection.new=0,this.diameter=new Float64Array(this.length),this.amplitude=new Float64Array(this.length),this.amplitude.max=new Float64Array(this.length);for(let t=0;t<this.length;t++){const e=t/this.length,i=e<.5?.4+2*e*1.6:.5+1.5*(2-2*e);this.diameter[t]=Math.min(i,1.9)}for(let t=0;t<this.length;t++)this.amplitude[t]=Math.pow(this.diameter[t],2),t>0&&(this.reflection[t]=(this.amplitude[t-1]-this.amplitude[t])/(this.amplitude[t-1]+this.amplitude[t]));this.diameter[0]=t.velum.target}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t,e){this.position=t,this.startTime=e,this.timeAlive=0,this.lifetime=.2,this.strength=.3,this.exponent=200}get amplitude(){return this.strength*Math.pow(-2,this.timeAlive*this.exponent)}get isAlive(){return this.timeAlive<this.lifetime}update(t){this.timeAlive=t-this.startTime}}}]);